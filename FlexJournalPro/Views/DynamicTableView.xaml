<UserControl x:Class="FlexJournalPro.Views.DynamicTableView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:local="clr-namespace:FlexJournalPro.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">

    <UserControl.Resources>
        <!-- Стиль для заголовків колонок -->
        <Style x:Key="DynamicTableColumnHeaderStyle" 
               TargetType="{x:Type DataGridColumnHeader}"
               BasedOn="{StaticResource MaterialDesignDataGridColumnHeader}">
            <Setter Property="Padding" Value="0"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <!-- Стиль для заголовків рядків з індикацією стану -->
        <Style x:Key="DynamicTableRowHeaderStyle" 
               TargetType="{x:Type DataGridRowHeader}">
            <Setter Property="Width" Value="40"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0,0,1,0"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type DataGridRowHeader}">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <Grid>
                                <TextBlock x:Name="StateIcon"
                                          FontSize="16"
                                          VerticalAlignment="Center"
                                          HorizontalAlignment="Center"
                                          Margin="5"
                                          Text=""
                                          Foreground="#757575"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Path=Item.IsPlaceholder, FallbackValue=False}" Value="True">
                                <Setter TargetName="StateIcon" Property="Text" Value="⏳"/>
                                <Setter TargetName="StateIcon" Property="Foreground" Value="#9E9E9E"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Path=Item.IsNewRowPlaceholder, FallbackValue=False}" Value="True">
                                <Setter TargetName="StateIcon" Property="Text" Value="➕"/>
                                <Setter TargetName="StateIcon" Property="Foreground" Value="#4CAF50"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Path=Item.IsDirty, FallbackValue=False}" Value="True">
                                <Setter TargetName="StateIcon" Property="Text" Value="✏️"/>
                                <Setter TargetName="StateIcon" Property="Foreground" Value="#FF9800"/>
                            </DataTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Стиль для клітинок -->
        <Style x:Key="DynamicTableCellStyle" 
               TargetType="{x:Type DataGridCell}"
               BasedOn="{StaticResource MaterialDesignDataGridCell}">
            <Setter Property="Padding" Value="0"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Stretch"/>
            
            <Style.Triggers>
                <!-- При виборі клітинки змінюємо фон, тільки рамка -->
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="BorderThickness" Value="1"/>
                </Trigger>

                <!-- При редагуванні прозорий фон, прибрати рамку -->
                <Trigger Property="IsEditing" Value="True">
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="BorderThickness" Value="0"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DynamicTableStyle"
               TargetType="{x:Type DataGrid}"
               BasedOn="{StaticResource MaterialDesignDataGrid}">
            <Setter Property="DataGrid.GridLinesVisibility" Value="All" />
        </Style>
               
    </UserControl.Resources>

    <DataGrid x:Name="DynamicGrid" 
                AutoGenerateColumns="False" 
                CanUserAddRows="False"
                IsReadOnly="False"
                HeadersVisibility="All"
                SelectionMode="Single"
                SelectionUnit="Cell"
                  
                Style="{StaticResource DynamicTableStyle}"
                RowHeaderStyle="{StaticResource DynamicTableRowHeaderStyle}"
                  
                ScrollViewer.HorizontalScrollBarVisibility="Auto"
                ScrollViewer.VerticalScrollBarVisibility="Auto"
                ScrollViewer.CanContentScroll="True"

                VirtualizingPanel.IsVirtualizing="True"
                VirtualizingPanel.VirtualizationMode="Recycling"
                EnableRowVirtualization="True"
                EnableColumnVirtualization="True">
    </DataGrid>
</UserControl>