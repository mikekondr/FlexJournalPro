<Window x:Class="FlexJournalPro.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:converters="clr-namespace:FlexJournalPro.Converters"
        xmlns:behaviors="clr-namespace:FlexJournalPro.Behaviors"
        xmlns:views="clr-namespace:FlexJournalPro.Views"
        mc:Ignorable="d"
        Title="ЖурналПро - Система управління журналами" 
        Height="700" 
        Width="1200"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="False"
        ResizeMode="CanResize"
        Background="{DynamicResource MaterialDesign.Brush.Background}">
    
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="48"
                      ResizeBorderThickness="5"
                      GlassFrameThickness="0"
                      CornerRadius="3"
                      UseAeroCaptionButtons="False"/>
    </WindowChrome.WindowChrome>
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:SidebarIconConverter x:Key="SidebarIconConverter"/>
        <converters:SelectedScreenBackgroundConverter x:Key="SelectedScreenBackgroundConverter"/>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <views:ScreenDataTemplateSelector x:Key="ScreenDataTemplateSelector"/>
        
        <Style x:Key="TitleBarButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="46"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="WindowChrome.IsHitTestVisibleInChrome" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" BorderThickness="0">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background">
                        <Setter.Value>
                            <SolidColorBrush Color="White" Opacity="0.1"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background">
                        <Setter.Value>
                            <SolidColorBrush Color="White" Opacity="0.2"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <Style x:Key="CloseButtonStyle" TargetType="Button" BasedOn="{StaticResource TitleBarButtonStyle}">
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E81123"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#8B0A14"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>
    
    <materialDesign:DialogHost Identifier="RootDialogHost">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="48"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <Border Grid.Row="0" 
                    Background="{DynamicResource MaterialDesign.Brush.Primary}"
                    BorderThickness="0,0,0,1"
                    BorderBrush="{DynamicResource MaterialDesign.Brush.Primary.Dark}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="16,0,0,0" VerticalAlignment="Center">
                        <materialDesign:PackIcon Kind="BookOpenPageVariant" Width="28" Height="28" Foreground="White" VerticalAlignment="Center"/>
                        <TextBlock Text="ЖурналПро" FontSize="16" FontWeight="SemiBold" Foreground="White" Margin="12,0,0,0" VerticalAlignment="Center"/>
                        <TextBlock Text="Система управління журналами" FontSize="12" Foreground="White" Opacity="0.7" Margin="12,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Style="{StaticResource TitleBarButtonStyle}" Click="MinimizeButton_Click" ToolTip="Згорнути">
                            <materialDesign:PackIcon Kind="WindowMinimize" Width="16" Height="16"/>
                        </Button>
                        
                        <Button x:Name="MaximizeButton" Style="{StaticResource TitleBarButtonStyle}" Click="MaximizeButton_Click" ToolTip="Розгорнути">
                            <materialDesign:PackIcon x:Name="MaximizeIcon" Kind="WindowMaximize" Width="16" Height="16"/>
                        </Button>
                        
                        <Button Style="{StaticResource CloseButtonStyle}" Click="CloseButton_Click" ToolTip="Закрити">
                            <materialDesign:PackIcon Kind="Close" Width="16" Height="16"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
            
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Border Grid.Column="0" Grid.Row="0" Grid.RowSpan="2"
                        Background="{DynamicResource MaterialDesign.Brush.Primary}"
                        BorderThickness="0,0,1,0"
                        BorderBrush="{DynamicResource MaterialDesign.Brush.Divider}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Margin="0,8,0,0">
                            <!-- Journals Section -->
                            <Border BorderThickness="0,0,0,1" BorderBrush="{DynamicResource MaterialDesign.Brush.Divider}" Margin="0,0,0,8">
                                <StackPanel>
                                    <TextBlock Text="Журнали" Style="{StaticResource MaterialDesignCaptionTextBlock}"
                                               Foreground="{DynamicResource MaterialDesign.Brush.Primary.Foreground}" Margin="16,8,16,4"
                                               Visibility="{Binding IsSidebarExpanded, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                                    <Button Style="{StaticResource MaterialDesignFlatButton}"
                                            Command="{Binding OpenJournalsListCommand}" HorizontalContentAlignment="Left" Padding="16,8"
                                            Foreground="{DynamicResource MaterialDesign.Brush.Primary.Foreground}">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="BookOpen" Width="24" Height="24" VerticalAlignment="Center"/>
                                            <TextBlock Text="Весь список" Margin="12,0,0,0" VerticalAlignment="Center"
                                                       Visibility="{Binding IsSidebarExpanded, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                            </Border>

                            <Border BorderThickness="0,0,0,1" BorderBrush="{DynamicResource MaterialDesign.Brush.Divider}" Margin="0,0,0,8">
                                <StackPanel>
                                    <TextBlock Text="Адміністрування" Style="{StaticResource MaterialDesignCaptionTextBlock}"
                                               Foreground="{DynamicResource MaterialDesign.Brush.Primary.Foreground}" Margin="16,8,16,4"
                                               Visibility="{Binding IsSidebarExpanded, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                                    <Button Style="{StaticResource MaterialDesignFlatButton}"
                                            Command="{Binding OpenTemplatesListCommand}" HorizontalContentAlignment="Left" Padding="16,8"
                                            Foreground="{DynamicResource MaterialDesign.Brush.Primary.Foreground}">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="FileDocument" Width="24" Height="24" VerticalAlignment="Center"/>
                                            <TextBlock Text="Шаблони" Margin="12,0,0,0" VerticalAlignment="Center"
                                                       Visibility="{Binding IsSidebarExpanded, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                        </StackPanel>
                                    </Button>

                                    <Button Style="{StaticResource MaterialDesignFlatButton}"
                                            Command="{Binding OpenUsersListCommand}" HorizontalContentAlignment="Left" Padding="16,8"
                                            Foreground="{DynamicResource MaterialDesign.Brush.Primary.Foreground}">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="AccountGroup" Width="24" Height="24" VerticalAlignment="Center"/>
                                            <TextBlock Text="Користувачі" Margin="12,0,0,0" VerticalAlignment="Center"
                                                       Visibility="{Binding IsSidebarExpanded, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <Button Grid.Row="1"
                                Style="{StaticResource MaterialDesignIconButton}"
                                Command="{Binding ToggleSidebarCommand}"
                                Margin="8"
                                Foreground="{DynamicResource MaterialDesign.Brush.Primary.Foreground}"
                                ToolTip="Показати/приховати меню"
                                HorizontalAlignment="Right">
                            <materialDesign:PackIcon Kind="{Binding IsSidebarExpanded, Converter={StaticResource SidebarIconConverter}}" 
                                                     Width="24" Height="24"/>
                        </Button>

                    </Grid>
                </Border>

                <Grid Grid.Column="1" Grid.Row="0">
                    <ContentControl Content="{Binding CurrentScreen}" ContentTemplateSelector="{StaticResource ScreenDataTemplateSelector}"/>
                    
                    <Grid Visibility="{Binding CurrentScreen, Converter={StaticResource NullToVisibilityConverter}}">
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <materialDesign:PackIcon Kind="BookOpenPageVariant" Width="120" Height="120" HorizontalAlignment="Center"
                                                     Foreground="{DynamicResource MaterialDesign.Brush.TextBox.HoverBackground}" Opacity="0.3"/>
                        </StackPanel>
                    </Grid>
                </Grid>

                <Border Grid.Column="1" Grid.Row="1"
                        Background="{DynamicResource MaterialDesign.Brush.Card.Background}"
                        BorderThickness="0,1,0,0" BorderBrush="{DynamicResource MaterialDesign.Brush.Divider}" Height="50">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="0" Style="{StaticResource MaterialDesignIconButton}" Command="{Binding ScrollLeftCommand}"
                                Visibility="{Binding CanScrollLeft, Converter={StaticResource BooleanToVisibilityConverter}}"
                                Width="30" Height="40" VerticalAlignment="Center" Margin="4,0,0,0">
                            <materialDesign:PackIcon Kind="ChevronLeft" Width="20" Height="20"/>
                        </Button>

                        <ScrollViewer Grid.Column="1" x:Name="ScreensPanelScrollViewer"
                                      HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Disabled">
                            <ListBox ItemsSource="{Binding OpenScreens}" SelectedItem="{Binding SelectedScreen}"
                                     BorderThickness="0" Background="Transparent"
                                     ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                     ScrollViewer.VerticalScrollBarVisibility="Disabled"
                                     behaviors:ListBoxBehavior.DisableScrollIntoView="True">
                                <ListBox.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ListBox.ItemsPanel>
                                <ListBox.ItemContainerStyle>
                                    <Style TargetType="ListBoxItem" BasedOn="{StaticResource {x:Type ListBoxItem}}">
                                        <Setter Property="Padding" Value="0"/>
                                        <Setter Property="Margin" Value="0"/>
                                        <Setter Property="Background" Value="Transparent"/>
                                        <Setter Property="Cursor" Value="Hand"/>
                                        <Setter Property="BorderThickness" Value="0"/>
                                        <Style.Triggers>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter Property="Background">
                                                    <Setter.Value>
                                                        <SolidColorBrush Color="#330061A4" Opacity="0.3"/>
                                                    </Setter.Value>
                                                </Setter>
                                            </Trigger>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background">
                                                    <Setter.Value>
                                                        <SolidColorBrush Color="#1A0061A4" Opacity="0.15"/>
                                                    </Setter.Value>
                                                </Setter>
                                            </Trigger>
                                            <MultiTrigger>
                                                <MultiTrigger.Conditions>
                                                    <Condition Property="IsSelected" Value="True"/>
                                                    <Condition Property="IsMouseOver" Value="True"/>
                                                </MultiTrigger.Conditions>
                                                <Setter Property="Background">
                                                    <Setter.Value>
                                                        <SolidColorBrush Color="#4D0061A4" Opacity="0.4"/>
                                                    </Setter.Value>
                                                </Setter>
                                            </MultiTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </ListBox.ItemContainerStyle>
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Border BorderThickness="0,0,1,0" BorderBrush="{DynamicResource MaterialDesign.Brush.Divider}" Background="Transparent">
                                            <Grid Width="200" Margin="8,4">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="8,4,4,4">
                                                    <materialDesign:PackIcon Kind="{Binding Icon}" Width="20" Height="20" VerticalAlignment="Center"/>
                                                    <TextBlock Text="{Binding Title}" Margin="8,0,0,0" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                                </StackPanel>

                                                <Button Grid.Column="1" Style="{StaticResource MaterialDesignIconButton}"
                                                        Command="{Binding DataContext.CloseScreenCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                        CommandParameter="{Binding}" Width="24" Height="24" Padding="0" Margin="4,0,8,0"
                                                        ToolTip="Закрити">
                                                    <materialDesign:PackIcon Kind="Close" Width="16" Height="16"/>
                                                </Button>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </ScrollViewer>

                        <Button Grid.Column="2" Style="{StaticResource MaterialDesignIconButton}" Command="{Binding ScrollRightCommand}"
                                Visibility="{Binding CanScrollRight, Converter={StaticResource BooleanToVisibilityConverter}}"
                                Width="30" Height="40" VerticalAlignment="Center" Margin="0,0,4,0">
                            <materialDesign:PackIcon Kind="ChevronRight" Width="20" Height="20"/>
                        </Button>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </materialDesign:DialogHost>
</Window>
